source("~/DAAAAMN/metamath/AMM/intermediate files/cluster.R", echo=TRUE)
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
geom_text_repel(data=k3leg$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
#read in df from intermediate data files
df <- read.csv("intermediate files/combined_df.csv")
#adds elite category based on rank
df$elite <- df$Rescaled.Rank < 40  #(recall rank indexes at 0)
# clustering analysis just based on % women and funding
# scale data to standard normal for clustering
gf_df<-cbind.data.frame(scale(df$Percentage.of.Women), scale(df$AwardedAmount))
### K Means clustering
k2 <- kmeans(gf_df, centers = 2, nstart = 25)
str(k2)
#visualize
fviz_cluster(k2, data = gf_df)
#how well did the clustering analysis identify "elite" institutions
cluster_df <- cbind.data.frame(k2$cluster, df$elite)
agg_df <- table(cluster_df)
#note that the stochastic nature of the clustering means
#that the table aggregates differently each time
#(1 and 2)
elite_true <- 31/40
elite_false <- 9/40
nonelite_true <- 112/121
nonelite_false <- 9/121
##  Check how many clusters this should have by plotting sum of squares
set.seed(123)
# function to compute total within-cluster sum of square
fviz_nbclust(gf_df, kmeans, method = "wss")
# sillhouette method instead
fviz_nbclust(gf_df, kmeans, method = "silhouette")
k3 <- kmeans(gf_df, centers = 3, nstart = 25)
str(k3)
#visualize
k3plot <-fviz_cluster(k3, data = gf_df) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "") +
theme_light()
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
geom_text_repel(data=k3leg$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3 <- kmeans(gf_df, centers = 3, nstart = 25)
str(k3)
#visualize
k3plot <-fviz_cluster(k3, data = gf_df) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "") +
theme_light()
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3leg
source("~/DAAAAMN/metamath/AMM/intermediate files/cluster.R", echo=TRUE)
k3leg
#visualize
k3plot <-fviz_cluster(k3, data = gf_df) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "") +
theme_light()
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
geom_text_repel(data=k3$data, aes(x=x, y=y, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3leg
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
geom_text_repel(data=k3$data, aes(x=x, y=y, label=none, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3leg
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=none, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3leg
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "")
k3leg <- fviz_cluster(k3, data = gf_df, geom = c("point")) +
scale_color_brewer('Cluster', palette='Set1') +
scale_fill_brewer('Cluster', palette='Set1') +
scale_shape_manual('Cluster', values=c(22,23,24)) +
ggtitle(label='') +
#  geom_text_repel(data=k3$data, aes(x=x, y=y, label=name, colour=cluster), show.legend = F, force_pull = 3, size = 2.8, min.segment.length = Inf) +
theme_light() + theme(legend.position = c(0.8, 0.7)) +
labs(y = "NSF DMS Average Annual Funding (scaled)", x = "Percentage of Women (scaled)", title = "")
k3leg
# function to compute total within-cluster sum of square
fviz_nbclust(gf_df, kmeans, method = "wss")
# sillhouette method instead
fviz_nbclust(gf_df, kmeans, method = "silhouette")
k3 <- kmeans(gf_df, centers = 3, nstart = 25)
str(k3)
#visualize
k3plot <-fviz_cluster(k3, data = gf_df) +
labs(y = "Total NSF funding (scaled)", x = "Proportion of Women (scaled)", title = "") +
theme_light()
k3plot
source("~/DAAAAMN/metamath/AMM/intermediate files/cluster.R", echo=TRUE)
